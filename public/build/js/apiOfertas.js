const er=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,num=/^[0-9]+$/,ofertas=document.querySelector("#ciudades"),navCiudades=document.createElement("NAV"),gridVacantes=document.querySelector(".grid-vacantes"),idURL=window.location.search.split("=")[1],tituloSpan=document.querySelector("#ciudad-vacante"),linkCiudad=document.querySelector("#link-ciudad"),infoOferta=document.querySelector(".info-oferta"),infoVacante=document.querySelector("#info-vacante"),infoVacante2=document.querySelector("#info-vacante2"),ciudadCargo=document.querySelector("#ciudad-cargo"),divIndex=document.querySelector(".grid-index-v"),formPostulacion=document.querySelector("#form-postulacion"),fieldset=document.querySelector("#fieldset"),postularCargo=document.querySelector("#postular-cargo"),identificacion=document.querySelector("#identificacion"),nombreCandidato=document.querySelector("#nombre-candidato"),apellidoCandidato=document.querySelector("#apellido-candidato"),edadCandidato=document.querySelector("#edad-candidato"),telefonoCandidato=document.querySelector("#telefono-candidato"),emailCandidato=document.querySelector("#email-candidato"),ciudadCandidato=document.querySelector("#ciudad-candidato"),estudiosCandidato=document.querySelector("#estudios-candidato"),hdvCandidato=document.querySelector("#hdv"),btnPostular=document.querySelector("#btn-postular"),candidato={id:null,identificacion:"",nombre:"",apellido:"",edad:"",telefono:"",email:"",ciudad:"",estudios:"",hdv:"",idOferta:idURL,fechaRec:null};function initApi(){consultaCiudades(),consultaOfertas()}function currency(e){var a=e.toString().split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),"$"+a.join(".")}async function consultaCiudades(){try{const e=await fetch("http://localhost:3000/api/ciudades"),a=await e.json();mostrarCiudades(a),tituloCiudad(a)}catch(e){console.log(e)}}function mostrarCiudades(e){if(ofertas){mostrarCiudad(e);document.querySelector("#buscar-ciudad").addEventListener("input",a=>{const t=e.filter(e=>e.nombre.toLowerCase().includes(a.target.value.toLowerCase()));a.target.value.length>1?mostrarCiudad(t):mostrarCiudad(e)})}}function mostrarCiudad(e){for(;navCiudades.firstChild;)navCiudades.removeChild(navCiudades.firstChild);e.forEach(e=>{const{id:a,nombre:t}=e,n=document.createElement("i");n.classList.add("fa","fa-solid","fa-briefcase","no-click");const d=document.createElement("P");d.textContent=t,d.classList.add("no-click");const o=document.createElement("DIV");o.classList.add("iconos","ofertas-icon"),o.appendChild(n),o.appendChild(d);const i=document.createElement("A");i.appendChild(o),i.href="/vacantes?id="+a,navCiudades.appendChild(i),ofertas.appendChild(navCiudades)})}function tituloCiudad(e){tituloSpan&&e.forEach(e=>{const{id:a,nombre:t}=e;a===idURL&&(tituloSpan.textContent=t)})}async function consultaOfertas(){try{const e=await fetch("http://localhost:3000/api/vacantes"),a=await e.json();ofertasIndex(a),mostrarOfertas(a),detalleVacante(a),postulacionVacante(a)}catch(e){console.log(e)}}function ofertasIndex(e){divIndex&&e.slice(e.length-4,e.length).forEach(e=>{const{id:a,cargo:t,salario:n,imagen:d,ciudad:o}=e,i=document.createElement("DIV");i.classList.add("vacante","vacante-index");const c=document.createElement("IMG");c.src="/images/"+d,c.alt="Vacante en: "+o,c.setAttribute("loading","lazy");const r=document.createElement("P"),l=document.createElement("SPAN");l.textContent=t,r.appendChild(l);const s=document.createElement("P");s.textContent=currency(n);const u=document.createElement("P");u.textContent="Ubicación: "+o;const m=document.createElement("A");m.classList.add("btn-vacante"),m.textContent="Ver oferta",m.href="/vacante?id="+a,i.appendChild(c),i.appendChild(r),i.appendChild(s),i.appendChild(u),i.appendChild(m),divIndex.appendChild(i)})}function mostrarOfertas(e){if(gridVacantes){const a=[...new Set(e.map(e=>e.idCiudad))];if(idURL&&!a.includes(idURL)){const e=document.querySelector(".sin-vacantes"),a=document.createElement("DIV");a.classList.add("sin-ofertas");const t=document.createElement("i");t.classList.add("fa","fa-solid","fa-warning");const n=document.createElement("P");n.textContent="En este momento no hay vacantes en esta ciudad. Revisa más adelante.",a.appendChild(t),a.appendChild(n),e.appendChild(a)}mostrarOferta(e);const t=document.querySelector("#buscar-cargo"),n=document.querySelector("#buscar-salario");n.addEventListener("change",()=>{const a=parseInt(n.value);mostrarOferta(e.filter(e=>e.salario>=a).sort((e,a)=>e.salario-a.salario))}),t.addEventListener("input",a=>{const t=e.filter(e=>e.cargo.toLowerCase().includes(a.target.value.toLowerCase()));a.target.value.length>1?mostrarOferta(t):mostrarOferta(e)})}}function mostrarOferta(e){for(;gridVacantes.firstChild;)gridVacantes.removeChild(gridVacantes.firstChild);e.forEach(e=>{const{id:a,cargo:t,salario:n,idCiudad:d,imagen:o,ciudad:i}=e;if(idURL===d){tituloSpan.textContent=i;const e=document.createElement("IMG");e.src="/images/"+o,e.setAttribute("alt","Vacante de "+t),e.setAttribute("loading","lazy");const d=document.createElement("P"),c=document.createElement("SPAN");c.textContent=t,d.appendChild(c);const r=document.createElement("P");r.textContent=currency(n);const l=document.createElement("A");l.textContent="Ver oferta",l.href="/vacante?id="+a,l.classList.add("btn-vacante");const s=document.createElement("DIV");s.classList.add("vacante"),s.appendChild(e),s.appendChild(d),s.appendChild(r),s.appendChild(l),gridVacantes.appendChild(s)}})}function detalleVacante(e){(infoVacante||infoVacante2)&&e.forEach(e=>{const{id:a,cargo:t,salario:n,horario:d,descripcion:o,correo:i,idCiudad:c,imagen:r,vencimiento:l,whatsapp:s,ciudad:u}=e;if(idURL===a){linkCiudad&&(linkCiudad.href="/vacantes?id="+c,linkCiudad.dataset.ciudad=c);document.querySelector("#oferta-actual").textContent="Vacante: "+t,infoOferta.style.backgroundImage=`url(/images/${r})`;const e=document.createElement("IMG");e.src="/images/"+r,e.setAttribute("alt","Vacante de "+t),e.setAttribute("loading","lazy"),infoVacante.appendChild(e);const m=document.createElement("H3"),p=document.createElement("SPAN");p.textContent="Ubicación: "+u,m.appendChild(p);const f=document.createElement("P");f.innerHTML="<span>Salario: </span>"+currency(n);const C=document.createElement("P");C.innerHTML="<span>Descripción: </span>"+o;const v=document.createElement("P");v.innerHTML="<span>Horario: </span>"+d;const h=document.createElement("P");h.innerHTML="<span>Email: </span>"+i;const g=document.createElement("P"),E=document.createElement("A");E.href="https://wa.me/+57"+s,E.setAttribute("target","_blank");const b=document.createElement("SPAN");b.classList.add("whats"),b.textContent="O escríbenos por WhatsApp dando click aquí",E.appendChild(b),g.appendChild(E);const y=document.createElement("P");y.innerHTML="<span>Esta vacante está disponible hasta el: </span>"+l;const L=document.createElement("A");L.textContent="Postularse",L.href="/postulacion?id="+a,L.classList.add("btn-postularse"),infoVacante2.appendChild(m),infoVacante2.appendChild(f),infoVacante2.appendChild(C),infoVacante2.appendChild(v),infoVacante2.appendChild(h),infoVacante2.appendChild(g),infoVacante2.appendChild(y),infoVacante2.appendChild(L)}})}function postulacionVacante(e){if(formPostulacion){e.find(e=>e.id===idURL)||(window.location.href="/ofertas"),e.forEach(e=>{const{id:a,cargo:t,ciudad:n}=e;idURL===a&&(postularCargo.textContent=`Aplicar al cargo de ${t} en ${n}`),leerPostulacion()})}}function leerPostulacion(){formPostulacion&&(identificacion.addEventListener("blur",validarCandidato),nombreCandidato.addEventListener("blur",validarCandidato),apellidoCandidato.addEventListener("blur",validarCandidato),edadCandidato.addEventListener("blur",validarCandidato),telefonoCandidato.addEventListener("blur",validarCandidato),emailCandidato.addEventListener("blur",validarCandidato),ciudadCandidato.addEventListener("blur",validarCandidato),estudiosCandidato.addEventListener("change",validarCandidato),hdvCandidato.addEventListener("change",validarCandidato,!1))}function validarCandidato(e){if(e.target.value.length>0){const e=document.querySelector(".alerta__error");e&&e.remove()}else mostrarError("Todos los campos son obligatorios");"email"===e.target.type&&!1===er.test(e.target.value)&&mostrarError("Email no valido"),"tel"===e.target.type&&(!1===num.test(e.target.value)||e.target.value.length<9)&&mostrarError("Teléfono no valido"),"number"===e.target.type&&(!1===num.test(e.target.value)||e.target.value<18||e.target.value>99)&&mostrarError("Edad no válida"),er.test(emailCandidato.value)&&""!==identificacion.value&&""!==nombreCandidato.value&&""!==apellidoCandidato.value&&""!==edadCandidato.value&&""!==ciudadCandidato.value&&""!==telefonoCandidato.value&&hdvCandidato.files.length>0&&(btnPostular.disabled=!1,btnPostular.classList.remove("btn-disabled"),console.log("se puede enviar"),llenarCandidato())}function mostrarError(e){const a=document.createElement("p");a.textContent=e,a.classList.add("alerta","alerta__error");0===document.querySelectorAll(".alerta__error").length&&formPostulacion.insertBefore(a,fieldset)}function llenarCandidato(){candidato.identificacion=identificacion.value,candidato.nombre=nombreCandidato.value,candidato.apellido=apellidoCandidato.value,candidato.edad=edadCandidato.value,candidato.telefono=telefonoCandidato.value,candidato.email=emailCandidato.value,candidato.ciudad=ciudadCandidato.value,candidato.estudios=estudiosCandidato.value,candidato.hdv=hdvCandidato.files[0],btnPostular.onclick=function(e){e.preventDefault(),enviarCandidato()}}async function enviarCandidato(){const{identificacion:e,nombre:a,apellido:t,edad:n,telefono:d,email:o,ciudad:i,estudios:c,hdv:r,idOferta:l}=candidato,s=new FormData;s.append("identificacion",e),s.append("nombre",a),s.append("apellido",t),s.append("edad",n),s.append("telefono",d),s.append("email",o),s.append("ciudad",i),s.append("estudios",c),s.append("hdv",r),s.append("idOferta",l);try{const e="http://localhost:3000/api/candidatos",a=await fetch(e,{method:"POST",body:s});let t=await a.text();t=JSON.parse(t),t.resultado&&Swal.fire({title:"Postulación Enviada",text:"Pronto te contactaremos",icon:"success"}).then(()=>{window.location.reload()})}catch(e){console.log(e),Swal.fire({title:"Error",text:"Mensaje no enviado. Intenta de nuevo",icon:"error"}).then(()=>{window.location.reload()})}}document.addEventListener("DOMContentLoaded",()=>{initApi()});
//# sourceMappingURL=apiOfertas.js.map
